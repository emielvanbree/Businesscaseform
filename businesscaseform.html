<!DOCTYPE html>
<html lang="en" class="bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesupply · Fulfilment Business Case</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Calibri, "Century Gothic", Arial, Helvetica, sans-serif;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="text-gray-800 bg-gradient-to-b from-[#fbfdff] to-[#f5f9fb]">

    <header class="bg-[#00B1E2] text-white p-4 sticky top-0 z-50 shadow-md flex items-center justify-between">
        <div>
            <h1 class="text-lg font-bold tracking-tight">Salesupply — Fulfilment Business Case</h1>
        </div>
        <img src="logo.jpg" alt="Salesupply Logo" class="h-full">
    </header>

    <div class="max-w-6xl mx-auto p-4 sm:p-6">

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <main class="lg:col-span-2 flex flex-col gap-6" id="form">
                
                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">1. Integration Overview</h2>
                    <p class="text-sm text-gray-500">Summarize the basic context of this warehouse integration.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="partner" class="block text-sm font-bold text-gray-700 mb-1">Warehouse Partner</label>
                            <input id="partner" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., DHL Supply Chain — Rheinberg">
                        </div>
                        <div>
                            <label for="region" class="block text-sm font-bold text-gray-700 mb-1">Country/Region</label>
                            <input id="region" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., DE / DACH">
                        </div>
                        <div>
                            <label for="integrationType" class="block text-sm font-bold text-gray-700 mb-1">Type of Integration</label>
                            <select id="integrationType" class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                                <option>New API development</option>
                                <option>Standard API configuration</option>
                                <option>One-off custom solution</option>
                            </select>
                        </div>
                        <div>
                            <label for="golive" class="block text-sm font-bold text-gray-700 mb-1">Expected Go-Live Date</label>
                            <input id="golive" type="date" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label for="fit" class="block text-sm font-bold text-gray-700 mb-1">Describe the required integration briefly</label>
                        <textarea id="fit" class="w-full p-3 border border-gray-300 rounded-lg min-h-[90px]" placeholder="Outline systems, processes, and special requirements."></textarea>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">2. Value Assessment</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="revenue" class="block text-sm font-bold text-gray-700 mb-1">Estimated Annual Revenue Growth (€)</label>
                            <input id="revenue" type="number" class="w-full p-3 border border-gray-300 rounded-lg text-right" placeholder="0" min="0" step="0.01">
                        </div>
                        <div>
                            <label for="volume" class="block text-sm font-bold text-gray-700 mb-1">Volume Growth (Orders / Month)</label>
                            <input id="volume" type="number" class="w-full p-3 border border-gray-300 rounded-lg text-right" placeholder="0" min="0" step="1">
                        </div>
                    </div>
                    <div>
                        <label for="expansion" class="block text-sm font-bold text-gray-700 mb-1">Customer / Market Expansion Benefits</label>
                        <textarea id="expansion" class="w-full p-3 border border-gray-300 rounded-lg min-h-[90px]" placeholder="New region access, strategic logo client..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 p-2 border rounded-full bg-white cursor-pointer hover:bg-gray-50"><input type="checkbox" id="sv_region"> New region access</label>
                        <label class="flex items-center gap-2 p-2 border rounded-full bg-white cursor-pointer hover:bg-gray-50"><input type="checkbox" id="sv_client"> Key client requirement</label>
                        <label class="flex items-center gap-2 p-2 border rounded-full bg-white cursor-pointer hover:bg-gray-50"><input type="checkbox" id="sv_position"> Competitive positioning</label>
                        <label class="flex items-center gap-2 p-2 border rounded-full bg-white cursor-pointer hover:bg-gray-50"><input type="checkbox" id="sv_portfolio"> Service portfolio improvement</label>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">3. Cost Assessment</h2>
                    <div class="space-y-4">
                        <p class="font-bold text-gray-600 border-t pt-4">3.1 Development Costs (one-off)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="c_newapi" class="block text-sm font-bold text-gray-700 mb-1">New API Development (€)</label><input id="c_newapi" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_custom" class="block text-sm font-bold text-gray-700 mb-1">Customization / Coding (€)</label><input id="c_custom" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                        <p class="font-bold text-gray-600 border-t pt-4">3.2 Setup & Configuration (one-off)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="c_setup_std" class="block text-sm font-bold text-gray-700 mb-1">Standard API setup (€)</label><input id="c_setup_std" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_setup_partner" class="block text-sm font-bold text-gray-700 mb-1">Partner-specific configuration (€)</label><input id="c_setup_partner" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                        <p class="font-bold text-gray-600 border-t pt-4">3.3 Other One-off Costs</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="c_test" class="block text-sm font-bold text-gray-700 mb-1">Testing / Certification (€)</label><input id="c_test" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_pm" class="block text-sm font-bold text-gray-700 mb-1">Project Management / Onboarding (€)</label><input id="c_pm" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                        <p class="font-bold text-gray-600 border-t pt-4">3.4 Recurring Operating Costs</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><label for="c_hosting" class="block text-sm font-bold text-gray-700 mb-1">Hosting & Maintenance (€/mo)</label><input id="c_hosting" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_support" class="block text-sm font-bold text-gray-700 mb-1">Support & Monitoring (€/mo)</label><input id="c_support" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_license" class="block text-sm font-bold text-gray-700 mb-1">SLA / License fees (€/mo)</label><input id="c_license" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">4. Risk Assessment</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="space-y-1"><label for="r_tech" class="block text-sm font-bold text-gray-700">Technical Risk</label><select id="r_tech" class="w-full p-3 border rounded-lg bg-white"><option>Low</option><option>Medium</option><option>High</option></select><textarea id="r_tech_notes" class="w-full p-3 border rounded-lg mt-1" placeholder="Untested WMS API..."></textarea></div>
                        <div class="space-y-1"><label for="r_dep" class="block text-sm font-bold text-gray-700">Dependency Risk</label><select id="r_dep" class="w-full p-3 border rounded-lg bg-white"><option>Low</option><option>Medium</option><option>High</option></select><textarea id="r_dep_notes" class="w-full p-3 border rounded-lg mt-1" placeholder="Reliance on partner..."></textarea></div>
                        <div class="space-y-1"><label for="r_com" class="block text-sm font-bold text-gray-700">Commercial Risk</label><select id="r_com" class="w-full p-3 border rounded-lg bg-white"><option>Low</option><option>Medium</option><option>High</option></select><textarea id="r_com_notes" class="w-full p-3 border rounded-lg mt-1" placeholder="Demand uncertainty..."></textarea></div>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">5. Recommendation</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="decision" class="block text-sm font-bold text-gray-700 mb-1">Go / No-Go</label><select id="decision" class="w-full p-3 border rounded-lg bg-white"><option>Recommended</option><option>Not Recommended</option><option>On Hold</option></select></div>
                        <div><label for="owner" class="block text-sm font-bold text-gray-700 mb-1">Business Case Owner</label><input id="owner" class="w-full p-3 border rounded-lg" placeholder="Your name / team"></div>
                    </div>
                    <div><label for="reasoning" class="block text-sm font-bold text-gray-700 mb-1">Reasoning (short)</label><textarea id="reasoning" class="w-full p-3 border rounded-lg min-h-[90px]" placeholder="Value vs. cost trade-off..."></textarea></div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 flex justify-between gap-4">
                    <button id="btnGenerateDoc" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-full shadow-lg hover:bg-blue-700 active:translate-y-px transition-all">Download Word (.doc)</button>
                    <button id="btnGenerateExcel" class="w-full bg-green-600 text-white font-bold py-3 px-5 rounded-full shadow-lg hover:bg-green-700 active:translate-y-px transition-all">Download Excel (.xlsx)</button>
                </section>
            </main>

            <aside class="lg:col-span-1">
                <div class="sticky top-24 bg-white border border-gray-200 rounded-2xl shadow-lg p-4">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Cost vs. Value Summary</h2>
                    <div class="space-y-4">
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-[#00B1E2]">
                            <div class="text-sm text-gray-600">Total One-off Technology Costs (€)</div>
                            <div id="out_oneoff" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-amber-500">
                            <div class="text-sm text-gray-600">Annual Recurring Technology Costs (€)</div>
                            <div id="out_recurring" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-rose-500">
                            <div class="text-sm text-gray-600">Annual Opex (€)</div>
                            <div id="out_opex" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-green-500">
                            <div class="text-sm text-gray-600">Expected Annual Revenue (€)</div>
                            <div id="out_revenue" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="text-sm text-gray-600">ROI after year 1</div>
                            <div id="out_roi_y1" class="text-xl font-extrabold text-gray-800">- %</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="text-sm text-gray-600">ROI after year 3</div>
                            <div id="out_roi_y3" class="text-xl font-extrabold text-gray-800">- %</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
        
        <footer class="text-center text-gray-500 mt-8 py-4">
            <small>© <span id="year"></span> Salesupply · Business Case tool.</small>
        </footer>
    </div>

    <script>
        const euroFormatter = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
        const percentFormatter = new Intl.NumberFormat('de-DE', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 });

        const get = id => document.getElementById(id);
        const fields = {
            partner: get('partner'), region: get('region'), integrationType: get('integrationType'), golive: get('golive'), fit: get('fit'),
            revenue: get('revenue'), volume: get('volume'), expansion: get('expansion'),
            sv_region: get('sv_region'), sv_client: get('sv_client'), sv_position: get('sv_position'), sv_portfolio: get('sv_portfolio'),
            c_newapi: get('c_newapi'), c_custom: get('c_custom'), c_setup_std: get('c_setup_std'), c_setup_partner: get('c_setup_partner'),
            c_test: get('c_test'), c_pm: get('c_pm'), c_hosting: get('c_hosting'), c_support: get('c_support'), c_license: get('c_license'),
            r_tech: get('r_tech'), r_tech_notes: get('r_tech_notes'), r_dep: get('r_dep'), r_dep_notes: get('r_dep_notes'), r_com: get('r_com'), r_com_notes: get('r_com_notes'),
            decision: get('decision'), owner: get('owner'), reasoning: get('reasoning')
        };

        const outputs = { 
            oneoff: get('out_oneoff'), 
            recurring: get('out_recurring'), 
            opex: get('out_opex'),
            revenue: get('out_revenue'),
            roi_y1: get('out_roi_y1'),
            roi_y3: get('out_roi_y3')
        };
        
        const numeric = (...els) => els.reduce((sum, el) => sum + (parseFloat(el.value) || 0), 0);

        function compute() {
            const oneoff = numeric(fields.c_newapi, fields.c_custom, fields.c_setup_std, fields.c_setup_partner, fields.c_test, fields.c_pm);
            const monthlyRecurring = numeric(fields.c_hosting, fields.c_support, fields.c_license);
            const annualRecurring = monthlyRecurring * 12;
            const annualRevenue = parseFloat(fields.revenue.value) || 0;
            const annualOpex = annualRevenue * 0.85;

            outputs.oneoff.textContent = euroFormatter.format(oneoff);
            outputs.recurring.textContent = euroFormatter.format(annualRecurring);
            outputs.opex.textContent = euroFormatter.format(annualOpex);
            outputs.revenue.textContent = euroFormatter.format(annualRevenue);

            const totalCostsY1 = oneoff + annualRecurring + annualOpex;
            const denominatorY1 = totalCostsY1;
            const roiY1 = (annualRevenue - totalCostsY1) / denominatorY1;
            
            const totalCostsY3 = oneoff + (annualRecurring * 3) + (annualOpex * 3);
            const denominatorY3 = totalCostsY3;
            const roiY3 = ((annualRevenue * 3) - totalCostsY3) / denominatorY3;
            
            if (denominatorY1 !== 0) {
                outputs.roi_y1.textContent = percentFormatter.format(roiY1);
            } else {
                outputs.roi_y1.textContent = "- %";
            }

            if (denominatorY3 !== 0) {
                outputs.roi_y3.textContent = percentFormatter.format(roiY3);
            } else {
                outputs.roi_y3.textContent = "- %";
            }

            return { oneoff, annualRecurring, annualOpex, annualRevenue, roiY1, roiY3 };
        }

        function gather() {
            const vals = Object.fromEntries(Object.entries(fields).map(([k, el]) => [k, (el.type === 'checkbox') ? el.checked : el.value]));
            return { ...vals, computed: compute(), meta: { generatedAt: new Date().toISOString() } };
        }

        function fill(data) {
            Object.entries(data || {}).forEach(([k, v]) => {
                if (!fields[k]) return;
                if (fields[k].type === 'checkbox') fields[k].checked = !!v;
                else fields[k].value = v;
            });
            compute();
        }

        document.querySelectorAll('#form input, #form select, #form textarea').forEach(el => {
            el.addEventListener('input', compute);
        });

        get('year').textContent = new Date().getFullYear();

        function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }
        function nl2br(s) { return String(s).replace(/\n/g, '<br/>'); }

        get('btnGenerateDoc').addEventListener('click', () => {
            const d = gather();
            const yes = v => v ? 'Yes' : 'No';
            const formatCurrency = val => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(parseFloat(val) || 0);
            const formatPercent = val => new Intl.NumberFormat('de-DE', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(parseFloat(val) || 0);

            const docStyles = `
                <style>
                    body { font-family: Calibri, 'Century Gothic', Arial, sans-serif; color: #434343; font-size: 11pt; }
                    h1 { color: #3D434C; font-size: 24pt; margin: 0 0 8pt; }
                    h2 { color: #3D434C; font-size: 16pt; margin: 20pt 0 6pt; border-bottom: 2px solid #00B1E2; padding-bottom: 4pt; }
                    h3 { color: #00B1E2; font-size: 13pt; margin: 12pt 0 6pt; }
                    table { border-collapse: collapse; width: 100%; margin: 12pt 0; }
                    th, td { border: 1px solid #E0E4E8; padding: 8pt; vertical-align: top; text-align: left; }
                    th { background: #F5FAFD; color: #3D434C; font-weight: bold; }
                    .meta { color: #666; font-size: 10pt; }
                    .kpi-summary { margin: 16pt 0; padding: 12pt; background: #F5FAFD; border-left: 4px solid #00B1E2; }
                    .kpi-summary p { margin: 0 0 6pt; }
                </style>`;

            const html = `<!DOCTYPE html><html><head><meta charset="utf-8">${docStyles}</head><body>
                <h1>Fulfilment Business Case</h1>
                <p class="meta">Partner: <strong>${escapeHtml(d.partner)}</strong> · Region: <strong>${escapeHtml(d.region)}</strong> · Go-Live: <strong>${escapeHtml(d.golive)}</strong></p>
                
                <h2>1. Integration Overview</h2>
                <table>
                    <tr><th>Warehouse Partner</th><td>${escapeHtml(d.partner)}</td></tr>
                    <tr><th>Type of Integration</th><td>${escapeHtml(d.integrationType)}</td></tr>
                    <tr><th>Strategic Fit</th><td>${nl2br(escapeHtml(d.fit))}</td></tr>
                </table>

                <h2>2. Value Assessment</h2>
                <table>
                    <tr><th>Estimated Annual Revenue Growth</th><td>${formatCurrency(d.revenue)}</td></tr>
                    <tr><th>Volume Growth (orders/month)</th><td>${escapeHtml(d.volume)}</td></tr>
                    <tr><th>Expansion Benefits</th><td>${nl2br(escapeHtml(d.expansion))}</td></tr>
                    <tr><th>Strategic Value</th><td>New region: <strong>${yes(d.sv_region)}</strong>, Key client: <strong>${yes(d.sv_client)}</strong>, Positioning: <strong>${yes(d.sv_position)}</strong>, Portfolio: <strong>${yes(d.sv_portfolio)}</strong></td></tr>
                </table>

                <h2>3. Cost Assessment</h2>
                <h3>One-off Costs</h3>
                <table>
                    <tr><th>New API Development</th><td>${formatCurrency(d.c_newapi)}</td></tr>
                    <tr><th>Customization / Coding</th><td>${formatCurrency(d.c_custom)}</td></tr>
                    <tr><th>Standard API setup</th><td>${formatCurrency(d.c_setup_std)}</td></tr>
                    <tr><th>Partner-specific config.</th><td>${formatCurrency(d.c_setup_partner)}</td></tr>
                    <tr><th>Testing / Certification</th><td>${formatCurrency(d.c_test)}</td></tr>
                    <tr><th>Project Management</th><td>${formatCurrency(d.c_pm)}</td></tr>
                </table>
                <h3>Recurring Costs (Monthly)</h3>
                <table>
                    <tr><th>Hosting & Maintenance</th><td>${formatCurrency(d.c_hosting)}</td></tr>
                    <tr><th>Support & Monitoring</th><td>${formatCurrency(d.c_support)}</td></tr>
                    <tr><th>SLA / License fees</th><td>${formatCurrency(d.c_license)}</td></tr>
                </table>

                <h2>4. Summary</h2>
                <div class="kpi-summary">
                    <p><strong>Total One-off Technology Costs:</strong> ${formatCurrency(d.computed.oneoff)}</p>
                    <p><strong>Annual Recurring Technology Costs:</strong> ${formatCurrency(d.computed.annualRecurring)}</p>
                    <p><strong>Annual Opex:</strong> ${formatCurrency(d.computed.annualOpex)}</p>
                    <p><strong>Expected Annual Revenue:</strong> ${formatCurrency(d.computed.annualRevenue)}</p>
                    <p><strong>ROI after year 1:</strong> ${formatPercent(d.computed.roiY1)}</p>
                    <p><strong>ROI after year 3:</strong> ${formatPercent(d.computed.roiY3)}</p>
                </div>

                <h2>5. Risks</h2>
                <table>
                    <tr><th>Technical Risk</th><td><strong>${escapeHtml(d.r_tech)}</strong><br>${nl2br(escapeHtml(d.r_tech_notes))}</td></tr>
                    <tr><th>Dependency Risk</th><td><strong>${escapeHtml(d.r_dep)}</strong><br>${nl2br(escapeHtml(d.r_dep_notes))}</td></tr>
                    <tr><th>Commercial Risk</th><td><strong>${escapeHtml(d.r_com)}</strong><br>${nl2br(escapeHtml(d.r_com_notes))}</td></tr>
                </table>

                <h2>6. Recommendation</h2>
                <table>
                    <tr><th>Decision</th><td><strong>${escapeHtml(d.decision)}</strong></td></tr>
                    <tr><th>Owner</th><td>${escapeHtml(d.owner)}</td></tr>
                    <tr><th>Reasoning</th><td>${nl2br(escapeHtml(d.reasoning))}</td></tr>
                </table>
                <p class="meta">Generated: ${(new Date()).toLocaleString('de-DE')}</p>
            </body></html>`;

            const blob = new Blob(['\uFE00', html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const partnerSafe = (d.partner || 'wms-business-case').replace(/[^a-z0-9-]/gi, '-').toLowerCase();
            a.download = `${partnerSafe}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        get('btnGenerateExcel').addEventListener('click', () => {
            const data = gather();
            const { partner, region, integrationType, golive, fit, revenue, volume, expansion, sv_region, sv_client, sv_position, sv_portfolio,
                    c_newapi, c_custom, c_setup_std, c_setup_partner, c_test, c_pm, c_hosting, c_support, c_license,
                    r_tech, r_tech_notes, r_dep, r_dep_notes, r_com, r_com_notes, decision, owner, reasoning, computed } = data;

            // Structure data for Excel sheet
            const ws_data = [
                ['Fulfilment Business Case'],
                [],
                ['1. Integration Overview'],
                ['Warehouse Partner:', partner],
                ['Country/Region:', region],
                ['Type of Integration:', integrationType],
                ['Expected Go-Live Date:', golive],
                ['Required Integration:', fit],
                [],
                ['2. Value Assessment'],
                ['Estimated Annual Revenue Growth (€):', parseFloat(revenue) || 0],
                ['Volume Growth (Orders / Month):', parseFloat(volume) || 0],
                ['Customer / Market Expansion Benefits:', expansion],
                ['Strategic Value (check all that apply):'],
                ['New region access:', sv_region ? 'Yes' : 'No'],
                ['Key client requirement:', sv_client ? 'Yes' : 'No'],
                ['Competitive positioning:', sv_position ? 'Yes' : 'No'],
                ['Service portfolio improvement:', sv_portfolio ? 'Yes' : 'No'],
                [],
                ['3. Cost Assessment'],
                ['One-off Costs'],
                ['New API Development (€):', parseFloat(c_newapi) || 0],
                ['Customization / Coding (€):', parseFloat(c_custom) || 0],
                ['Standard API setup (€):', parseFloat(c_setup_std) || 0],
                ['Partner-specific config. (€):', parseFloat(c_setup_partner) || 0],
                ['Testing / Certification (€):', parseFloat(c_test) || 0],
                ['Project Management / Onboarding (€):', parseFloat(c_pm) || 0],
                ['Recurring Costs (Monthly)'],
                ['Hosting & Maintenance (€/mo):', parseFloat(c_hosting) || 0],
                ['Support & Monitoring (€/mo):', parseFloat(c_support) || 0],
                ['SLA / License fees (€/mo):', parseFloat(c_license) || 0],
                [],
                ['4. Financial Summary'],
                ['Total One-off Technology Costs (€):', computed.oneoff],
                ['Annual Recurring Technology Costs (€):', computed.annualRecurring],
                ['Annual Opex (€):', computed.annualOpex],
                ['Expected Annual Revenue (€):', computed.annualRevenue],
                ['ROI after year 1:', computed.roiY1],
                ['ROI after year 3:', computed.roiY3],
                [],
                ['5. Risk Assessment'],
                ['Technical Risk:', r_tech],
                ['Notes:', r_tech_notes],
                ['Dependency Risk:', r_dep],
                ['Notes:', r_dep_notes],
                ['Commercial Risk:', r_com],
                ['Notes:', r_com_notes],
                [],
                ['6. Recommendation'],
                ['Decision:', decision],
                ['Business Case Owner:', owner],
                ['Reasoning:', reasoning],
            ];

            // Create a worksheet
            const ws = XLSX.utils.aoa_to_sheet(ws_data);

            // Apply formatting (styles and column widths)
            ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 1 } }];
            ws['A1'].s = { font: { sz: 16, bold: true, color: { rgb: "00B1E2" } } };
            
            // Bold headings
            const boldCells = ['A3', 'A10', 'A19', 'A20', 'A27', 'A32', 'A33', 'A41', 'A49'];
            boldCells.forEach(cell => {
                if (ws[cell]) {
                    ws[cell].s = { font: { bold: true } };
                }
            });

            // Format numbers
            ws['B11'].t = 'n'; // Revenue
            ws['B12'].t = 'n'; // Volume
            ws['B22'].t = 'n'; // New API
            ws['B23'].t = 'n'; // Custom
            ws['B24'].t = 'n'; // Std setup
            ws['B25'].t = 'n'; // Partner setup
            ws['B26'].t = 'n'; // Testing
            ws['B27'].t = 'n'; // PM
            ws['B29'].t = 'n'; // Hosting
            ws['B30'].t = 'n'; // Support
            ws['B31'].t = 'n'; // License
            ws['B34'].t = 'n'; ws['B34'].z = '0.00" €"'; // oneoff
            ws['B35'].t = 'n'; ws['B35'].z = '0.00" €"'; // recurring
            ws['B36'].t = 'n'; ws['B36'].z = '0.00" €"'; // opex
            ws['B37'].t = 'n'; ws['B37'].z = '0.00" €"'; // revenue
            ws['B38'].t = 'n'; ws['B38'].z = '0.00%'; // ROI y1
            ws['B39'].t = 'n'; ws['B39'].z = '0.00%'; // ROI y3
            
            // Set column widths for better readability
            ws['!cols'] = [{ wch: 30 }, { wch: 50 }];

            // Create a workbook and append the worksheet
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Business Case Summary");

            // Generate and download the file
            const partnerSafe = (partner || 'business-case').replace(/[^a-z0-9-]/gi, '-').toLowerCase();
            XLSX.writeFile(wb, `${partnerSafe}.xlsx`);
        });

        compute();
    </script>
</body>
</html>
