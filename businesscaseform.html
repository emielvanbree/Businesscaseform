<!DOCTYPE html>
<html lang="en" class="bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesupply · Fulfilment Business Case</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Calibri, "Century Gothic", Arial, Helvetica, sans-serif;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="text-gray-800 bg-gradient-to-b from-[#fbfdff] to-[#f5f9fb]">

    <header class="bg-[#00B1E2] text-white p-4 sticky top-0 z-50 shadow-md flex items-center justify-between">
        <div>
            <h1 class="text-lg font-bold tracking-tight">Salesupply — Fulfilment Business Case</h1>
        </div>
        <img src="logo.jpg" alt="Salesupply Logo" class="h-full">
    </header>

    <div class="max-w-6xl mx-auto p-4 sm:p-6">

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <main class="lg:col-span-2 flex flex-col gap-6" id="form">
                
                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">1. Integration Overview</h2>
                    <p class="text-sm text-gray-500">Summarize the basic context of this warehouse integration.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="partner" class="block text-sm font-bold text-gray-700 mb-1">Project Name</label>
                            <input id="partner" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., DHL Supply Chain — Rheinberg">
                        </div>
                        <div>
                            <label for="integrationType" class="block text-sm font-bold text-gray-700 mb-1">Type of work</label>
                            <select id="integrationType" class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                                <option>New Integration</option>
                                <option>New, Custom, one-off Integration</option>
                                <option>Workflow addition/change</option>
                            </select>
                        </div>
                        <div>
                            <label for="golive" class="block text-sm font-bold text-gray-700 mb-1">Expected Go-Live Date (if applicable)</label>
                            <input id="golive" type="date" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="ticket" class="block text-sm font-bold text-gray-700 mb-1">Link ticket request CU (?)</label>
                            <input id="ticket" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., CU-12345">
                        </div>
                    </div>
                    <div>
                        <label for="problem" class="block text-sm font-bold text-gray-700 mb-1">Which problem does the project solve?</label>
                        <textarea id="problem" class="w-full p-3 border border-gray-300 rounded-lg min-h-[90px]" placeholder="Outline the problem this project is intended to solve."></textarea>
                    </div>
                    <div>
                        <label for="alternatives" class="block text-sm font-bold text-gray-700 mb-1">Alternative solutions to solve the problem?</label>
                        <textarea id="alternatives" class="w-full p-3 border border-gray-300 rounded-lg min-h-[90px]" placeholder="List and briefly describe alternative solutions considered."></textarea>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">2. Value Assessment</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="revenue" class="block text-sm font-bold text-gray-700 mb-1">Estimated Annual Revenue Growth (€)</label>
                            <input id="revenue" type="number" class="w-full p-3 border border-gray-300 rounded-lg text-right" placeholder="0" min="0" step="0.01">
                        </div>
                        <div>
                            <label for="volume" class="block text-sm font-bold text-gray-700 mb-1">Volume / Growth (Orders / Month) (if applicable)</label>
                            <input id="volume" type="number" class="w-full p-3 border border-gray-300 rounded-lg text-right" placeholder="0" min="0" step="1">
                        </div>
                    </div>
                    <div>
                        <label for="nonMonetaryBenefits" class="block text-sm font-bold text-gray-700 mb-1">Other non monetary benefits</label>
                        <textarea id="nonMonetaryBenefits" class="w-full p-3 border border-gray-300 rounded-lg min-h-[90px]" placeholder="List other benefits like brand reputation, team knowledge gain, etc."></textarea>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-gray-700 mb-1">Strategic Value (check all that apply)</label>
                        
                        <div class="flex items-start gap-2 p-2 border border-gray-200 rounded-lg bg-white">
                            <input type="checkbox" id="sv_region" class="mt-1">
                            <div class="flex-1">
                                <label for="sv_region" class="block text-sm font-bold text-gray-700 cursor-pointer">New region access</label>
                                <textarea id="sv_region_notes" class="w-full p-2 border rounded-lg mt-1 text-sm" placeholder="Reason for selecting this option..."></textarea>
                            </div>
                        </div>
                        
                        <div class="flex items-start gap-2 p-2 border border-gray-200 rounded-lg bg-white">
                            <input type="checkbox" id="sv_client" class="mt-1">
                            <div class="flex-1">
                                <label for="sv_client" class="block text-sm font-bold text-gray-700 cursor-pointer">Key client requirement</label>
                                <textarea id="sv_client_notes" class="w-full p-2 border rounded-lg mt-1 text-sm" placeholder="Reason for selecting this option..."></textarea>
                            </div>
                        </div>
                        
                        <div class="flex items-start gap-2 p-2 border border-gray-200 rounded-lg bg-white">
                            <input type="checkbox" id="sv_position" class="mt-1">
                            <div class="flex-1">
                                <label for="sv_position" class="block text-sm font-bold text-gray-700 cursor-pointer">Competitive positioning</label>
                                <textarea id="sv_position_notes" class="w-full p-2 border rounded-lg mt-1 text-sm" placeholder="Reason for selecting this option..."></textarea>
                            </div>
                        </div>
                        
                        <div class="flex items-start gap-2 p-2 border border-gray-200 rounded-lg bg-white">
                            <input type="checkbox" id="sv_portfolio" class="mt-1">
                            <div class="flex-1">
                                <label for="sv_portfolio" class="block text-sm font-bold text-gray-700 cursor-pointer">Service portfolio improvement</label>
                                <textarea id="sv_portfolio_notes" class="w-full p-2 border rounded-lg mt-1 text-sm" placeholder="Reason for selecting this option..."></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">3. Cost Assessment</h2>
                    <div class="space-y-4">
                        <p class="font-bold text-gray-600 border-t pt-4">3.1 Development Costs (one-off)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="c_due_diligence" class="block text-sm font-bold text-gray-700 mb-1">Due Diligence Check & Technical Investigation time (€)</label><input id="c_due_diligence" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_dev" class="block text-sm font-bold text-gray-700 mb-1">Development time/costs (€)</label><input id="c_dev" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_other_dev" class="block text-sm font-bold text-gray-700 mb-1">Other (external) development costs (€)</label><input id="c_other_dev" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                        <p class="font-bold text-gray-600 border-t pt-4">3.2 Other one-off costs</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="c_po_pm" class="block text-sm font-bold text-gray-700 mb-1">PO/PM time/costs (€)</label><input id="c_po_pm" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_testing" class="block text-sm font-bold text-gray-700 mb-1">Testing/certification time/costs (€)</label><input id="c_testing" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_docs" class="block text-sm font-bold text-gray-700 mb-1">Documentation time/costs (€)</label><input id="c_docs" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                        <p class="font-bold text-gray-600 border-t pt-4">3.3 Recurring Operating Costs</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><label for="c_hosting" class="block text-sm font-bold text-gray-700 mb-1">Hosting Maintenance (€/mo) (if applicable)</label><input id="c_hosting" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_support" class="block text-sm font-bold text-gray-700 mb-1">Support & Monitoring (€/mo) (if applicable)</label><input id="c_support" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_license" class="block text-sm font-bold text-gray-700 mb-1">SLA/License fees (€/mo) (if applicable)</label><input id="c_license" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                            <div><label for="c_other_recurring" class="block text-sm font-bold text-gray-700 mb-1">Other costs (from outcome talks with finance) (€/mo)</label><input id="c_other_recurring" type="number" class="w-full p-3 border rounded-lg text-right" placeholder="0" min="0" step="0.01"></div>
                        </div>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 space-y-4">
                    <h2 class="text-lg font-bold text-gray-700">4. Recommendation</h2>
                    <p class="text-sm text-gray-500">Note: This is the recommendation of the BO (Business Owner) based on the data, but this does not mean the recommendation of the PO (Product Owner) will be the same.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="decision" class="block text-sm font-bold text-gray-700 mb-1">Go / No-Go</label>
                            <select id="decision" class="w-full p-3 border rounded-lg bg-white"><option>Recommended</option><option>Not Recommended</option><option>On Hold</option></select>
                        </div>
                        <div><label for="owner" class="block text-sm font-bold text-gray-700 mb-1">Business Case Owner</label>
                            <input id="owner" class="w-full p-3 border rounded-lg" placeholder="Your name / team">
                        </div>
                    </div>
                    <div><label for="reasoning" class="block text-sm font-bold text-gray-700 mb-1">Reasoning (short)</label>
                        <textarea id="reasoning" class="w-full p-3 border rounded-lg min-h-[90px]" placeholder="Value vs. cost trade-off..."></textarea>
                    </div>
                </section>

                <section class="bg-white border border-gray-200 rounded-2xl shadow-lg p-4 flex justify-between gap-4">
                    <button id="btnGenerateDoc" class="w-full bg-blue-600 text-white font-bold py-3 px-5 rounded-full shadow-lg hover:bg-blue-700 active:translate-y-px transition-all">Download Word (.doc)</button>
                    <button id="btnGenerateExcel" class="w-full bg-green-600 text-white font-bold py-3 px-5 rounded-full shadow-lg hover:bg-green-700 active:translate-y-px transition-all">Download Excel (.xlsx)</button>
                </section>
            </main>

            <aside class="lg:col-span-1">
                <div class="sticky top-24 bg-white border border-gray-200 rounded-2xl shadow-lg p-4">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Monetary Costs vs. Benefits summary</h2>
                    <div class="space-y-4">
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-[#00B1E2]">
                            <div class="text-sm text-gray-600">Total One-off Technology Costs (€)</div>
                            <div id="out_oneoff" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-amber-500">
                            <div class="text-sm text-gray-600">Annual Recurring Technology Costs (€)</div>
                            <div id="out_recurring" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-rose-500">
                            <div class="text-sm text-gray-600">Annual Opex (€)</div>
                            <div id="out_opex" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-green-500">
                            <div class="text-sm text-gray-600">Expected Annual Revenue (€)</div>
                            <div id="out_revenue" class="text-xl font-extrabold text-gray-800">€ 0</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="text-sm text-gray-600">ROI after year 1</div>
                            <div id="out_roi_y1" class="text-xl font-extrabold text-gray-800">- %</div>
                        </div>
                        <div class="bg-slate-100 p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="text-sm text-gray-600">ROI after year 3</div>
                            <div id="out_roi_y3" class="text-xl font-extrabold text-gray-800">- %</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
        
        <footer class="text-center text-gray-500 mt-8 py-4">
            <small>© <span id="year"></span> Salesupply · Business Case tool.</small>
        </footer>
    </div>

    <script>
        const euroFormatter = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
        const percentFormatter = new Intl.NumberFormat('de-DE', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 });

        const get = id => document.getElementById(id);
        const fields = {
            partner: get('partner'), integrationType: get('integrationType'), golive: get('golive'), ticket: get('ticket'), problem: get('problem'), alternatives: get('alternatives'),
            revenue: get('revenue'), volume: get('volume'), nonMonetaryBenefits: get('nonMonetaryBenefits'),
            sv_region: get('sv_region'), sv_region_notes: get('sv_region_notes'), 
            sv_client: get('sv_client'), sv_client_notes: get('sv_client_notes'), 
            sv_position: get('sv_position'), sv_position_notes: get('sv_position_notes'), 
            sv_portfolio: get('sv_portfolio'), sv_portfolio_notes: get('sv_portfolio_notes'),
            c_due_diligence: get('c_due_diligence'), c_dev: get('c_dev'), c_other_dev: get('c_other_dev'),
            c_po_pm: get('c_po_pm'), c_testing: get('c_testing'), c_docs: get('c_docs'), 
            c_hosting: get('c_hosting'), c_support: get('c_support'), c_license: get('c_license'), c_other_recurring: get('c_other_recurring'),
            decision: get('decision'), owner: get('owner'), reasoning: get('reasoning')
        };

        const outputs = { 
            oneoff: get('out_oneoff'), 
            recurring: get('out_recurring'), 
            opex: get('out_opex'),
            revenue: get('out_revenue'),
            roi_y1: get('out_roi_y1'),
            roi_y3: get('out_roi_y3')
        };
        
        const numeric = (...els) => els.reduce((sum, el) => sum + (parseFloat(el.value) || 0), 0);

        function compute() {
            const oneoff = numeric(fields.c_due_diligence, fields.c_dev, fields.c_other_dev, fields.c_po_pm, fields.c_testing, fields.c_docs);
            const monthlyRecurring = numeric(fields.c_hosting, fields.c_support, fields.c_license, fields.c_other_recurring);
            const annualRecurring = monthlyRecurring * 12;
            const annualRevenue = parseFloat(fields.revenue.value) || 0;
            const annualOpex = annualRevenue * 0.85;

            outputs.oneoff.textContent = euroFormatter.format(oneoff);
            outputs.recurring.textContent = euroFormatter.format(annualRecurring);
            outputs.opex.textContent = euroFormatter.format(annualOpex);
            outputs.revenue.textContent = euroFormatter.format(annualRevenue);

            const totalCostsY1 = oneoff + annualRecurring + annualOpex;
            const denominatorY1 = totalCostsY1;
            const roiY1 = (annualRevenue - totalCostsY1) / denominatorY1;
            
            const totalCostsY3 = oneoff + (annualRecurring * 3) + (annualOpex * 3);
            const denominatorY3 = totalCostsY3;
            const roiY3 = ((annualRevenue * 3) - totalCostsY3) / denominatorY3;
            
            if (denominatorY1 !== 0) {
                outputs.roi_y1.textContent = percentFormatter.format(roiY1);
            } else {
                outputs.roi_y1.textContent = "- %";
            }

            if (denominatorY3 !== 0) {
                outputs.roi_y3.textContent = percentFormatter.format(roiY3);
            } else {
                outputs.roi_y3.textContent = "- %";
            }

            return { oneoff, annualRecurring, annualOpex, annualRevenue, roiY1, roiY3 };
        }

        function gather() {
            const vals = Object.fromEntries(Object.entries(fields).map(([k, el]) => [k, (el.type === 'checkbox') ? el.checked : el.value]));
            return { ...vals, computed: compute(), meta: { generatedAt: new Date().toISOString() } };
        }

        function fill(data) {
            Object.entries(data || {}).forEach(([k, v]) => {
                if (!fields[k]) return;
                if (fields[k].type === 'checkbox') fields[k].checked = !!v;
                else fields[k].value = v;
            });
            compute();
        }

        document.querySelectorAll('#form input, #form select, #form textarea').forEach(el => {
            el.addEventListener('input', compute);
        });

        get('year').textContent = new Date().getFullYear();

        function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }
        function nl2br(s) { return String(s).replace(/\n/g, '<br/>'); }

        get('btnGenerateDoc').addEventListener('click', () => {
            const d = gather();
            const yes = v => v ? 'Yes' : 'No';
            const formatCurrency = val => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(parseFloat(val) || 0);
            const formatPercent = val => new Intl.NumberFormat('de-DE', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(parseFloat(val) || 0);

            const docStyles = `
                <style>
                    body { font-family: Calibri, 'Century Gothic', Arial, sans-serif; color: #434343; font-size: 11pt; }
                    h1 { color: #3D434C; font-size: 24pt; margin: 0 0 8pt; }
                    h2 { color: #3D434C; font-size: 16pt; margin: 20pt 0 6pt; border-bottom: 2px solid #00B1E2; padding-bottom: 4pt; }
                    h3 { color: #00B1E2; font-size: 13pt; margin: 12pt 0 6pt; }
                    table { border-collapse: collapse; width: 100%; margin: 12pt 0; }
                    th, td { border: 1px solid #E0E4E8; padding: 8pt; vertical-align: top; text-align: left; }
                    th { background: #F5FAFD; color: #3D434C; font-weight: bold; }
                    .meta { color: #666; font-size: 10pt; }
                    .kpi-summary { margin: 16pt 0; padding: 12pt; background: #F5FAFD; border-left: 4px solid #00B1E2; }
                    .kpi-summary p { margin: 0 0 6pt; }
                </style>`;

            const html = `<!DOCTYPE html><html><head><meta charset="utf-8">${docStyles}</head><body>
                <h1>Fulfilment Business Case</h1>
                <p class="meta">Project: <strong>${escapeHtml(d.partner)}</strong> · Go-Live: <strong>${escapeHtml(d.golive)}</strong></p>
                
                <h2>1. Integration Overview</h2>
                <table>
                    <tr><th>Project Name</th><td>${escapeHtml(d.partner)}</td></tr>
                    <tr><th>Type of work</th><td>${escapeHtml(d.integrationType)}</td></tr>
                    <tr><th>Which problem does the project solve?</th><td>${nl2br(escapeHtml(d.problem))}</td></tr>
                    <tr><th>Alternative solutions</th><td>${nl2br(escapeHtml(d.alternatives))}</td></tr>
                    <tr><th>Link ticket request CU (?)</th><td>${escapeHtml(d.ticket)}</td></tr>
                </table>

                <h2>2. Value Assessment</h2>
                <table>
                    <tr><th>Estimated Annual Revenue Growth</th><td>${formatCurrency(d.revenue)}</td></tr>
                    <tr><th>Volume / Growth (orders/month) (if applicable)</th><td>${escapeHtml(d.volume)}</td></tr>
                    <tr><th>Other non monetary benefits</th><td>${nl2br(escapeHtml(d.nonMonetaryBenefits))}</td></tr>
                    <tr><th>New region access</th><td><strong>${yes(d.sv_region)}</strong><br>${nl2br(escapeHtml(d.sv_region_notes))}</td></tr>
                    <tr><th>Key client requirement</th><td><strong>${yes(d.sv_client)}</strong><br>${nl2br(escapeHtml(d.sv_client_notes))}</td></tr>
                    <tr><th>Competitive positioning</th><td><strong>${yes(d.sv_position)}</strong><br>${nl2br(escapeHtml(d.sv_position_notes))}</td></tr>
                    <tr><th>Service portfolio improvement</th><td><strong>${yes(d.sv_portfolio)}</strong><br>${nl2br(escapeHtml(d.sv_portfolio_notes))}</td></tr>
                </table>

                <h2>3. Cost Assessment</h2>
                <h3>3.1 Development Costs (one-off)</h3>
                <table>
                    <tr><th>Due Diligence Check & Technical Investigation time</th><td>${formatCurrency(d.c_due_diligence)}</td></tr>
                    <tr><th>Development time/costs</th><td>${formatCurrency(d.c_dev)}</td></tr>
                    <tr><th>Other (external) development costs</th><td>${formatCurrency(d.c_other_dev)}</td></tr>
                </table>
                <h3>3.2 Other one-off costs</h3>
                <table>
                    <tr><th>PO/PM time/costs</th><td>${formatCurrency(d.c_po_pm)}</td></tr>
                    <tr><th>Testing/certification time/costs</th><td>${formatCurrency(d.c_testing)}</td></tr>
                    <tr><th>Documentation time/costs</th><td>${formatCurrency(d.c_docs)}</td></tr>
                </table>
                <h3>3.3 Recurring Operating Costs</h3>
                <table>
                    <tr><th>Hosting Maintenance (if applicable)</th><td>${formatCurrency(d.c_hosting)}</td></tr>
                    <tr><th>Support & Monitoring (if applicable)</th><td>${formatCurrency(d.c_support)}</td></tr>
                    <tr><th>SLA/License fees (if applicable)</th><td>${formatCurrency(d.c_license)}</td></tr>
                    <tr><th>Other costs (from outcome talks with finance)</th><td>${formatCurrency(d.c_other_recurring)}</td></tr>
                </table>

                <h2>4. Monetary Costs vs. Benefits summary</h2>
                <div class="kpi-summary">
                    <p><strong>Total One-off Technology Costs:</strong> ${formatCurrency(d.computed.oneoff)}</p>
                    <p><strong>Annual Recurring Technology Costs:</strong> ${formatCurrency(d.computed.annualRecurring)}</p>
                    <p><strong>Annual Opex:</strong> ${formatCurrency(d.computed.annualOpex)}</p>
                    <p><strong>Expected Annual Revenue:</strong> ${formatCurrency(d.computed.annualRevenue)}</p>
                    <p><strong>ROI after year 1:</strong> ${formatPercent(d.computed.roiY1)}</p>
                    <p><strong>ROI after year 3:</strong> ${formatPercent(d.computed.roiY3)}</p>
                </div>

                <h2>5. Recommendation</h2>
                <table>
                    <tr><th>Decision</th><td><strong>${escapeHtml(d.decision)}</strong></td></tr>
                    <tr><th>Owner</th><td>${escapeHtml(d.owner)}</td></tr>
                    <tr><th>Reasoning</th><td>${nl2br(escapeHtml(d.reasoning))}</td></tr>
                </table>
                <p class="meta">Note: This is the recommendation of the BO (Business Owner) based on the data, but this does not mean the recommendation of the PO (Product Owner) will be the same.</p>
                <p class="meta">Generated: ${(new Date()).toLocaleString('de-DE')}</p>
            </body></html>`;

            const blob = new Blob(['\uFE00', html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const partnerSafe = (d.partner || 'Fulfilment-business-case').replace(/[^a-z0-9-]/gi, '-').toLowerCase();
            a.download = `${partnerSafe}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        get('btnGenerateExcel').addEventListener('click', () => {
            const data = gather();
            const { partner, integrationType, golive, ticket, problem, alternatives, revenue, volume, nonMonetaryBenefits,
                    sv_region, sv_region_notes, sv_client, sv_client_notes, sv_position, sv_position_notes, sv_portfolio, sv_portfolio_notes,
                    c_due_diligence, c_dev, c_other_dev, c_po_pm, c_testing, c_docs, c_hosting, c_support, c_license, c_other_recurring,
                    decision, owner, reasoning, computed } = data;

            const ws_data = [
                ['Fulfilment Business Case'],
                [],
                ['1. Integration Overview'],
                ['Project Name:', partner],
                ['Type of work:', integrationType],
                ['Expected Go-Live Date (if applicable):', golive],
                ['Link ticket request ClickUp:', ticket],
                ['Which problem does the project solve?:', problem],
                ['Alternative solutions:', alternatives],
                [],
                ['2. Value Assessment'],
                ['Estimated Annual Revenue Growth (€):', parseFloat(revenue) || 0],
                ['Volume / Growth (Orders / Month) (if applicable):', parseFloat(volume) || 0],
                ['Other non monetary benefits:', nonMonetaryBenefits],
                ['Strategic Value:'],
                ['New region access:', sv_region ? 'Yes' : 'No'],
                ['Justification:', sv_region_notes],
                ['Key client requirement:', sv_client ? 'Yes' : 'No'],
                ['Justification:', sv_client_notes],
                ['Competitive positioning:', sv_position ? 'Yes' : 'No'],
                ['Justification:', sv_position_notes],
                ['Service portfolio improvement:', sv_portfolio ? 'Yes' : 'No'],
                ['Justification:', sv_portfolio_notes],
                [],
                ['3. Cost Assessment'],
                ['3.1 Development Costs (one-off)'],
                ['Due Diligence Check & Technical Investigation time (€):', parseFloat(c_due_diligence) || 0],
                ['Development time/costs (€):', parseFloat(c_dev) || 0],
                ['Other (external) development costs (€):', parseFloat(c_other_dev) || 0],
                ['3.2 Other one-off costs'],
                ['PO/PM time/costs (€):', parseFloat(c_po_pm) || 0],
                ['Testing/certification time/costs (€):', parseFloat(c_testing) || 0],
                ['Documentation time/costs (€):', parseFloat(c_docs) || 0],
                ['3.3 Recurring Operating Costs'],
                ['Hosting Maintenance (€/mo) (if applicable):', parseFloat(c_hosting) || 0],
                ['Support & Monitoring (€/mo) (if applicable):', parseFloat(c_support) || 0],
                ['SLA/License fees (€/mo) (if applicable):', parseFloat(c_license) || 0],
                ['Other costs (from outcome talks with finance) (€/mo):', parseFloat(c_other_recurring) || 0],
                [],
                ['4. Monetary Costs vs. Benefits summary'],
                ['Total One-off Technology Costs (€):', computed.oneoff],
                ['Annual Recurring Technology Costs (€):', computed.annualRecurring],
                ['Annual Opex (€):', computed.annualOpex],
                ['Expected Annual Revenue (€):', computed.annualRevenue],
                ['ROI after year 1:', computed.roiY1],
                ['ROI after year 3:', computed.roiY3],
                [],
                ['5. Recommendation'],
                ['Decision:', decision],
                ['Business Case Owner:', owner],
                ['Reasoning:', reasoning],
            ];

            const ws = XLSX.utils.aoa_to_sheet(ws_data);

            ws['!merges'] = [{ s: { r: 0, c: 0 }, e: { r: 0, c: 1 } }];
            ws['A1'].s = { font: { sz: 16, bold: true, color: { rgb: "00B1E2" } } };
            
            const boldCells = ['A3', 'A10', 'A14', 'A24', 'A25', 'A29', 'A33', 'A40', 'A47'];
            boldCells.forEach(cell => {
                if (ws[cell]) {
                    ws[cell].s = { font: { bold: true } };
                }
            });

            ws['B11'].t = 'n';
            ws['B12'].t = 'n';
            ws['B26'].t = 'n';
            ws['B27'].t = 'n';
            ws['B28'].t = 'n';
            ws['B30'].t = 'n';
            ws['B31'].t = 'n';
            ws['B32'].t = 'n';
            ws['B34'].t = 'n';
            ws['B35'].t = 'n';
            ws['B36'].t = 'n';
            ws['B37'].t = 'n';
            ws['B41'].t = 'n'; ws['B41'].z = '0.00" €"';
            ws['B42'].t = 'n'; ws['B42'].z = '0.00" €"';
            ws['B43'].t = 'n'; ws['B43'].z = '0.00" €"';
            ws['B44'].t = 'n'; ws['B44'].z = '0.00" €"';
            ws['B45'].t = 'n'; ws['B45'].z = '0.00%';
            ws['B46'].t = 'n'; ws['B46'].z = '0.00%';
            
            ws['!cols'] = [{ wch: 30 }, { wch: 50 }];

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Business Case Summary");

            const partnerSafe = (partner || 'business-case').replace(/[^a-z0-9-]/gi, '-').toLowerCase();
            XLSX.writeFile(wb, `${partnerSafe}.xlsx`);
        });

        compute();
    </script>
</body>
</html>

